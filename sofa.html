<script>
    
</script>

 <?php
   // Report all errors
   ini_set("error_reporting",E_ALL);
?> 
 <?php
   // Create new session or connect to existing one
   session_start()
?> 
<?php
   // Report all errors
   ini_set("error_reporting",E_ALL);
?>
 <?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Retrieve and validate form data
    $NHI = $_POST["nhi"];
    $SName = $_POST["surname"];
    $FName = $_POST["firstname"];

    // Set cookies
    setcookie("patient-nhi", $NHI, time() + 3600, "/");
    setcookie("patient-surname", $SName, time() + 3600, "/");
    setcookie("patient-firstname", $FName, time() + 3600, "/");
}
?> 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOFA Score Calculator</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/script.js"></script>
</head>
            
<body>
    <h1>SOFA Score Calculator</h1>
    <form  method="post">
        <h2>Patient Details</h2>
        <!-- Add inputs for each component here -->
        <?php
            // dump the post array to see what's there for testing
            //var_dump($_POST);
            // get the data that was posted 
           $FName = $_POST["firstname"];
           $SName=$_POST["surname"];
           $NHI=$_POST["nhi"];
           echo "<pre>";
           echo "This is the First Name provided: $FName \r\n";
           echo "This is the Surname provided: $SName \r\n";
           echo "This is the NHI number provided: $NHI \r\n";
           echo "</pre>";
        ?> 
    </form>

    <form id="respiratory"  method="post">
        <h2>Respiratory System</h2>
        <label for="respiratory_binary">Is the patient using mechanical ventilation?</label>
        <select id="respiratory_binary" name="respiratory_binary" required>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
        </select>
        <label for="respiratory_numeric">What is your Respiratory System rate PaO2/FiO2 mmHg</label>
        <input type="number" id="respiratory_numeric" name="respiratory_numeric" step="0.01" required placeholder="e.g. 400 mmHg" >
        
        <script>
            document.getElementById('respiratory_numeric').addEventListener('input', function() {
            selectedRespiratoryValue =document.getElementById('respiratory_numeric').value;
            console.log(selectedRespiratoryValue , "the respiratory_numeric value ");
            
        });
        document.getElementById('respiratory_binary').addEventListener('change', function() {
            selectedRespiratoryBool = document.getElementById('respiratory_binary').value;
            console.log(selectedRespiratoryBool , " venterlator yes or no");
        });
        </script>


        <h2>Nervous System</h2>
    <label for="nervous_numeric">Central nervous system (Glasgow coma scale)</label>
    <input type="number" id="nervous_numeric" name="nervous_numeric" step="0.01" placeholder =" e.g. 15" >

    <script>
            document.getElementById('nervous_numeric').addEventListener('input', function() {
            selectedCNS =document.getElementById('nervous_numeric').value;
            console.log(selectedCNS , "the nervous_numeric value ");
        });
        </script>

    <!-- Cardiovascular System -->
    <h2>Cardiovascular System</h2>
    <label for="cardiovascular1">Cardiovascular system (Mean arterial pressure OR administration of vasopressors required):</label>
    <input type="number" id="cardiovascular1" name="cardiovascular1" step="0.01" placeholder =" e.g. 80 mmHg">
    <label for="cardiovascular2">Parameter 2:</label>
    <input type="number" id="cardiovascular2" name="cardiovascular2">
    <!-- Add inputs for the remaining cardiovascular parameters as needed -->

    <!--  Liver -->
    <h2>Liver</h2>  
    <label for="liver">Liver (Bilirubin (mg/dl))</label>
    <input type="number" id="liver" name="liver" step="0.01" placeholder =" e.g. 1.2 mg/dl">

    <script>
        document.getElementById('liver').addEventListener('input', function() {
        selectedLiver =document.getElementById('liver').value;
        console.log(selectedLiver , "the liver value ");
    });
    </script>

    <!--  Coagulation -->
    <h2>Coagulation</h2>
    <label for="coagulation">Coagulation (Platelets×10^3/μl)</label>
    <input type="number" id="coagulation" name="coagulation" step="0.01" placeholder =" e.g. 150 10^3/μl">

    <script>
        document.getElementById('coagulation').addEventListener('input', function() {
        selectedCoagulation =document.getElementById('coagulation').value;
        console.log(selectedCoagulation , "the coagulation value ");
    });
    </script>

    <!--  Kidneys -->
    <h2>Kidneys</h2>
    <label for="kidneys">Kidneys function (Creatinine (mg/dl))</label>
    <input type="number" id="kidneys" name="kidneys"  placeholder =" e.g. 1.2 mg/dl">

    <script>
        document.getElementById('kidneys').addEventListener('input', function() {
        selectedKidneys =document.getElementById('kidneys').value;
        console.log(selectedKidneys , "the kidneys value ");
    });
    </script>

    <input type="submit" value="Calculate Score" onclick="submitForm()">
    <input type="button" value="Return to previous page" onClick="javascript:history.go(-1)" /> 
     </form>
     <script>
        //gobal varibales
        var selectedRespiratoryValue = 400;
            var selectedRespiratoryBool = "Yes"; //defult value
            var selectedCardiovascular = 70;
            var selectedCNS = 15;
            var selectedCoagulation = 150;
            var selectedLiver = 1.2;
            var selectedKidneys = 1.2;
            var points = 0;
            var totalPoints = 0;

        function submitForm(){
            //testing that the values are saved in the varaiables correctly
            console.log(selectedRespiratoryBool , 'respetory bool');
            console.log(selectedRespiratoryValue , 'Respatory num');
            console.log(selectedCNS , 'nervious');
            console.log(selectedCardiovascular , 'heart');
            console.log(selectedLiver , 'liver');
            console.log(selectedCoagulation , 'platlets');
            console.log(selectedKidneys , 'kidneys');

            //submit for checks the valibity for the values and calls the calculate method
            calculate();

        }
        function calculate(){
            //calls all the diffrent functions that calculates the points based on the input
            checkCNS();
        }
        function checkCNS(){
           //checks the Nervous system
            if(selectedCNS == 15){
                points += 0; 
            }else if (selectedCNS >= 13 && selectedCNS <= 14) {
                 points += 1;
            } else if (selectedCNS >= 10 && selectedCNS <= 12) {
                    points += 2;
            } else if (selectedCNS >= 6 && selectedCNS <= 9) {
                points += 3;
            } else if (selectedCNS < 6) {
                points += 4;
            }
            console.log(points , "points value for CNS");
            console.log(selectedCNS , "checkcns()")

            if(selectedRespiratoryValue >= 400){
                points += 0; 
            }else if (selectedRespiratoryValue < 400) {
                 points += 1;
            } else if (selectedRespiratoryValue < 300 && selectedRespiratoryBool == "No") {
                    points += 2;
            } else if (selectedRespiratoryValue < 200 && selectedRespiratoryBool == "Yes") {
                points += 3;
            } else if (selectedRespiratoryValue < 100 && selectedRespiratoryBool == "Yes") {
                points += 4;
            }
            console.log(points);
            console.log(selectedRespiratoryValue , selectedRespiratoryBool );
            if(selectedCoagulation >= 150){
                points += 0; 
            }else if (selectedCoagulation < 150) {
                 points += 1;
            } else if (selectedCoagulation < 100 ) {
                    points += 2;
            } else if (selectedCoagulation < 50 ) {
                points += 3;
            } else if (selectedCoagulation < 20) {
                points += 4;
            }
            console.log(points , "points value up to coagulation");
        }
    
    </script>
</body>

</html>
